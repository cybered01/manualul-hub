---
import Layout from '../layouts/Layout.astro';
import WhatsAppButton from '../components/WhatsAppButton.astro';
import data from '../data/renovare.json';

const title = "Deviz »òantier 2026 - Calculator Renovare Expert";
const description = "CalculeazƒÉ un deviz detaliat pentru renovarea casei tale. Control total pe camere, instala»õii, finisaje »ôi logisticƒÉ.";
---

<Layout title={title} description={description}>
    <main class="max-w-5xl mx-auto px-4 pb-32">
        <header class="py-12 text-center">
            <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-[10px] font-black uppercase tracking-widest border border-orange-200 mb-4 inline-block">
                Deviz Detaliat v2.0
            </span>
            <h1 class="text-4xl md:text-6xl font-black text-gray-900 mb-4 tracking-tight">
                Deviz <span class="text-[#d35400]">»òantier</span>
            </h1>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                Treci de la o estimare grosierƒÉ la un plan de buget real pe categorii de lucrƒÉri.
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left: Configurations -->
            <div class="lg:col-span-8 space-y-8">

                <!-- Section 1: Dimensiuni -->
                <div class="bg-white rounded-[40px] shadow-xl border border-gray-100 overflow-hidden">
                    <div class="p-8 bg-[#d35400] text-white flex justify-between items-center">
                        <h2 class="text-xl font-bold italic">1. Suprafe»õe »ôi Camere</h2>
                        <span class="text-3xl">üìè</span>
                    </div>
                    <div class="p-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-black uppercase text-gray-400 mb-2">Suprafa»õƒÉ UtilƒÉ TotalƒÉ (mp)</label>
                            <input type="number" id="inSuprafata" value="60" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl p-4 font-black text-gray-900 outline-none focus:border-[#d35400]">
                        </div>
                        <div>
                            <label class="block text-xs font-black uppercase text-gray-400 mb-2">NumƒÉr Camere</label>
                            <input type="number" id="inCamere" value="2" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl p-4 font-black text-gray-900 outline-none focus:border-[#d35400]">
                        </div>
                        <div>
                            <label class="block text-xs font-black uppercase text-gray-400 mb-2">Suprafa»õƒÉ Pere»õi (EstimatƒÉ mp)</label>
                            <input type="number" id="inPereti" value="180" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl p-4 font-black text-gray-900 outline-none focus:border-[#d35400]">
                            <p class="text-[10px] text-gray-400 mt-2 italic">*RegulƒÉ: aprox. Suprafa»õa utilƒÉ x 3.</p>
                        </div>
                        <div>
                            <label class="block text-xs font-black uppercase text-gray-400 mb-2">Tip Imobil</label>
                            <select id="inTipImobil" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl p-4 font-bold text-gray-900 outline-none focus:border-[#d35400]">
                                <option value="vechi">Vechi (NecesitƒÉ Decopertare)</option>
                                <option value="nou">Nou (Construc»õie la Gri)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Instala»õii »ôi Finisaje -->
                <div class="bg-white rounded-[40px] shadow-xl border border-gray-100 overflow-hidden">
                    <div class="p-8 bg-gray-900 text-white flex justify-between items-center">
                        <h2 class="text-xl font-bold italic">2. Instala»õii »ôi Finisaje</h2>
                        <span class="text-3xl">‚ö°</span>
                    </div>
                    <div class="p-8 space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-xs font-black uppercase text-gray-400 mb-3 tracking-widest">Instala»õie ElectricƒÉ</label>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-3 p-3 rounded-xl border-2 border-gray-100 cursor-pointer has-[:checked]:border-[#d35400] has-[:checked]:bg-orange-50 transition-all">
                                        <input type="radio" name="electrica" value="nu" class="w-4 h-4 accent-[#d35400]">
                                        <span class="text-sm font-bold">Nu schimb / ExistentƒÉ</span>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 rounded-xl border-2 border-gray-100 cursor-pointer has-[:checked]:border-[#d35400] has-[:checked]:bg-orange-50 transition-all">
                                        <input type="radio" name="electrica" value="standard" checked class="w-4 h-4 accent-[#d35400]">
                                        <span class="text-sm font-bold">Standard (Cupru, tablou nou)</span>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 rounded-xl border-2 border-gray-100 cursor-pointer has-[:checked]:border-[#d35400] has-[:checked]:bg-orange-50 transition-all">
                                        <input type="radio" name="electrica" value="smart" class="w-4 h-4 accent-[#d35400]">
                                        <span class="text-sm font-bold">Smart Home (AutomatizƒÉri)</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-black uppercase text-gray-400 mb-3 tracking-widest">Sistem √éncƒÉlzire</label>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-3 p-3 rounded-xl border-2 border-gray-100 cursor-pointer has-[:checked]:border-[#d35400] has-[:checked]:bg-orange-50 transition-all">
                                        <input type="radio" name="incalzire" value="nu" checked class="w-4 h-4 accent-[#d35400]">
                                        <span class="text-sm font-bold">ExistentƒÉ (Calorifere vechi)</span>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 rounded-xl border-2 border-gray-100 cursor-pointer has-[:checked]:border-[#d35400] has-[:checked]:bg-orange-50 transition-all">
                                        <input type="radio" name="incalzire" value="centrala" class="w-4 h-4 accent-[#d35400]">
                                        <span class="text-sm font-bold">CentralƒÉ NouƒÉ + Calorifere</span>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 rounded-xl border-2 border-gray-100 cursor-pointer has-[:checked]:border-[#d35400] has-[:checked]:bg-orange-50 transition-all">
                                        <input type="radio" name="incalzire" value="pardoseala" class="w-4 h-4 accent-[#d35400]">
                                        <span class="text-sm font-bold">√éncƒÉlzire √Æn PardosealƒÉ</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pt-6 border-t border-gray-100">
                            <div>
                                <label class="block text-xs font-black uppercase text-gray-400 mb-3 tracking-widest">Finisaje Pere»õi</label>
                                <div class="flex gap-4">
                                    <label class="flex-1 flex flex-col items-center gap-2 p-4 rounded-2xl border-2 border-gray-100 cursor-pointer has-[:checked]:border-[#d35400] has-[:checked]:bg-orange-50">
                                        <input type="radio" name="pereti" value="lavabila" checked class="accent-[#d35400]">
                                        <span class="text-xs font-bold uppercase">LavabilƒÉ</span>
                                    </label>
                                    <label class="flex-1 flex flex-col items-center gap-2 p-4 rounded-2xl border-2 border-gray-100 cursor-pointer has-[:checked]:border-[#d35400] has-[:checked]:bg-orange-50">
                                        <input type="radio" name="pereti" value="tapet" class="accent-[#d35400]">
                                        <span class="text-xs font-bold uppercase">Tapet / Decor.</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-black uppercase text-gray-400 mb-3 tracking-widest">Calitate Materiale</label>
                                <select id="inCalitate" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl p-4 font-bold text-gray-900 outline-none focus:border-[#d35400]">
                                    <option value="budget">Buget (Ecomomic)</option>
                                    <option value="standard" selected>Standard (Mediu)</option>
                                    <option value="premium">Premium (Lux)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: LogisticƒÉ »ôi Moloz -->
                <div class="bg-white rounded-[40px] shadow-xl border border-gray-100 overflow-hidden">
                    <div class="p-8 bg-slate-100 text-slate-700 flex justify-between items-center">
                        <h2 class="text-xl font-bold italic">3. LogisticƒÉ »ôi »òantier</h2>
                        <span class="text-3xl">üöõ</span>
                    </div>
                    <div class="p-8">
                        <details class="group">
                            <summary class="flex items-center justify-between cursor-pointer list-none text-sm font-bold text-slate-500 hover:text-[#d35400] transition-colors">
                                <span>üì¶ ARATƒÇ DETALII LOGISTICƒÇ (Etaj, Moloz, Manipulare)</span>
                                <svg class="w-5 h-5 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </summary>

                            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-[10px] font-black uppercase text-slate-400 mb-2">Etaj</label>
                                        <input type="number" id="inEtaj" value="0" min="0" class="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-3 font-bold">
                                    </div>
                                    <label class="flex items-center gap-3 p-3 rounded-xl bg-slate-50 cursor-pointer">
                                        <input type="checkbox" id="inLift" checked class="w-5 h-5 accent-[#d35400]">
                                        <span class="text-sm font-bold text-slate-700">ExistƒÉ lift func»õional?</span>
                                    </label>
                                </div>

                                <div class="space-y-4">
                                    <label class="block text-[10px] font-black uppercase text-slate-400 mb-2">Evacuare Moloz</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-[8px] font-bold text-slate-500 mb-1">Nr. Saci</label>
                                            <input type="number" id="inSaci" value="50" class="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-3 font-bold">
                                        </div>
                                        <div>
                                            <label class="block text-[8px] font-bold text-slate-500 mb-1">Containere (7mc)</label>
                                            <input type="number" id="inContainere" value="0" class="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-3 font-bold">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
            </div>

            <!-- Right: Results Sidebar -->
            <div class="lg:col-span-4 space-y-6">
                <div class="bg-gray-900 text-white rounded-[40px] p-8 shadow-2xl sticky top-6">
                    <h3 class="text-xl font-bold mb-8 flex items-center gap-2">
                        <span class="text-[#d35400]">üìã</span> Rezumat Deviz
                    </h3>

                    <div class="space-y-4 mb-8">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">ManoperƒÉ:</span>
                            <span id="outManopera" class="font-bold">0 ‚Ç¨</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">Materiale:</span>
                            <span id="outMateriale" class="font-bold">0 ‚Ç¨</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">Instala»õii:</span>
                            <span id="outInstalatii" class="font-bold">0 ‚Ç¨</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">LogisticƒÉ & Moloz:</span>
                            <span id="outLogistica" class="font-bold">0 ‚Ç¨</span>
                        </div>
                        <div class="pt-4 border-t border-white/10 flex justify-between items-center text-orange-400">
                            <span class="text-xs font-black uppercase tracking-wider">NeprevƒÉzute (15%):</span>
                            <span id="outUrgenta" class="font-bold">0 ‚Ç¨</span>
                        </div>
                    </div>

                    <div class="text-center p-6 bg-white/5 rounded-3xl border border-white/10 mb-8">
                        <p class="text-[10px] font-black uppercase text-gray-500 tracking-[0.2em] mb-2">Total Estimativ 2026</p>
                        <p id="outTotal" class="text-5xl font-black text-[#d35400]">0 ‚Ç¨</p>
                    </div>

                    <WhatsAppButton idDesktop="whatsappBtn" idMobile="whatsappBtnFloating" />
                </div>

                <div class="bg-orange-50 p-6 rounded-[32px] border border-orange-100">
                    <h4 class="font-bold text-orange-900 mb-2 flex items-center gap-2">
                        <span>üí°</span> Sfat »òantier
                    </h4>
                    <p class="text-xs text-orange-800 leading-relaxed">
                        DacƒÉ e»ôti la etajul 4 fƒÉrƒÉ lift, costul manoperei pentru manipularea materialelor poate cre»ôte devizul cu peste 1000‚Ç¨. AsigurƒÉ-te cƒÉ echipa a inclus acest aspect!
                    </p>
                </div>
            </div>
        </div>
    </main>

    <script is:inline define:vars={{ data }}>
        function calculate() {
            // Basic Inputs
            const suprafata = parseFloat(document.getElementById('inSuprafata').value) || 0;
            const camere = parseFloat(document.getElementById('inCamere').value) || 0;
            const suprafataPereti = parseFloat(document.getElementById('inPereti').value) || 0;
            const tipImobil = document.getElementById('inTipImobil').value;
            const calitate = document.getElementById('inCalitate').value;

            // Instala»õii
            const electrica = document.querySelector('input[name="electrica"]:checked').value;
            const incalzire = document.querySelector('input[name="incalzire"]:checked').value;
            const peretiFinisaj = document.querySelector('input[name="pereti"]:checked').value;

            // LogisticƒÉ
            const etaj = parseInt(document.getElementById('inEtaj').value) || 0;
            const areLift = document.getElementById('inLift').checked;
            const saci = parseInt(document.getElementById('inSaci').value) || 0;
            const containere = parseInt(document.getElementById('inContainere').value) || 0;

            // --- CALCULE ---

            // 1. ManoperƒÉ »ôi Materiale Generale
            let manopera = suprafata * data.manopera_generala;
            if (tipImobil === 'vechi') {
                manopera += suprafata * data.decopertare;
            }

            let materiale = suprafata * (data.materiale[calitate] || 0);

            // 2. Instala»õii
            let instalatiiTotal = 0;
            if (electrica === 'standard') instalatiiTotal += suprafata * data.electrica.standard;
            if (electrica === 'smart') instalatiiTotal += suprafata * data.electrica.smart;

            if (incalzire === 'centrala') instalatiiTotal += data.incalzire.centrala;
            if (incalzire === 'pardoseala') instalatiiTotal += suprafata * data.incalzire.pardoseala;

            // 3. Pere»õi
            materiale += suprafataPereti * (data.pereti[peretiFinisaj] || 0);

            // 4. LogisticƒÉ
            let logisticaTotal = 0;
            logisticaTotal += saci * data.moloz.sac;
            logisticaTotal += containere * data.moloz.container;

            if (etaj > 0 && !areLift) {
                // Manipulare manualƒÉ pe scƒÉri
                logisticaTotal += etaj * data.logistica.etaj_fara_lift * (suprafata / 10);
            }

            // Extra standard (Sanitare, Usi, Mobila - mentinem ideea de baza)
            instalatiiTotal += data.extra.sanitara;
            const usiCost = (camere + 1) * data.extra.usa;
            materiale += usiCost;

            // 5. Total
            const subtotal = manopera + materiale + instalatiiTotal + logisticaTotal;
            const neprevazute = subtotal * 0.15;
            const total = subtotal + neprevazute;

            // --- AFISARE ---
            document.getElementById('outManopera').innerText = Math.round(manopera).toLocaleString() + " ‚Ç¨";
            document.getElementById('outMateriale').innerText = Math.round(materiale).toLocaleString() + " ‚Ç¨";
            document.getElementById('outInstalatii').innerText = Math.round(instalatiiTotal).toLocaleString() + " ‚Ç¨";
            document.getElementById('outLogistica').innerText = Math.round(logisticaTotal).toLocaleString() + " ‚Ç¨";
            document.getElementById('outUrgenta').innerText = Math.round(neprevazute).toLocaleString() + " ‚Ç¨";
            document.getElementById('outTotal').innerText = Math.round(total).toLocaleString() + " ‚Ç¨";

            // WhatsApp Update
            const mesaj = `üèóÔ∏è Deviz »òantier Manualul.ro:\n\nTotal estimat renovare 2026: ${Math.round(total).toLocaleString()} EUR\n\nDefalcare:\n- ManoperƒÉ: ${Math.round(manopera).toLocaleString()} EUR\n- Materiale: ${Math.round(materiale).toLocaleString()} EUR\n- Instala»õii: ${Math.round(instalatiiTotal).toLocaleString()} EUR\n\nVezi devizul complet: ${window.location.href}`;
            const link = `https://api.whatsapp.com/send?text=${encodeURIComponent(mesaj)}`;

            document.getElementById('whatsappBtn').href = link;
            document.getElementById('whatsappBtnFloating').href = link;
        }

        // Listeners
        const allInputs = document.querySelectorAll('input, select');
        allInputs.forEach(input => input.addEventListener('input', calculate));

        // Initial run
        calculate();
    </script>
</Layout>
