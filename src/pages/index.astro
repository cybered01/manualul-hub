---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import { readFileSync } from 'fs';
import { parse } from 'csv-parse/sync';

const fileContent = readFileSync('./src/data/agricultura.csv', 'utf-8');
const records = parse(fileContent, { columns: true, skip_empty_lines: true });

// Grupăm datele pe județe
const dateGrupate = records.reduce((acc, current) => {
  if (!acc[current.Judet]) {
    acc[current.Judet] = [];
  }
  acc[current.Judet].push(current);
  return acc;
}, {});

const judete = Object.keys(dateGrupate).sort();
---

<Layout title="Calculator Profit Agricol 2026 - Analiză pe Județe">
	<main class="max-w-6xl mx-auto px-4 py-16">
		<header class="text-center mb-16">
			<h1 class="text-5xl font-black text-gray-900 mb-6 tracking-tight">
				Cât profit faci la hectar în <span class="text-green-600">2026</span>?
			</h1>
			<p class="text-xl text-gray-600 max-w-2xl mx-auto">
				Previziuni bazate pe noile subvenții APIA, costuri de producție estimate și prețurile pieței pe regiuni.
			</p>
		</header>
		
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
			{judete.map((judet) => (
				<div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
					<h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
						<span class="w-2 h-6 bg-green-500 rounded-full mr-3"></span>
						Județul {judet}
					</h2>
					<div class="space-y-2">
						{dateGrupate[judet].map((item) => (
							<a href={`/${item.ID}`} class="block p-3 rounded-xl bg-gray-50 hover:bg-green-50 text-gray-700 hover:text-green-700 font-medium transition-colors border border-transparent hover:border-green-100">
								Analiză profit {item.Cultura} →
							</a>
						))}
					</div>
				</div>
			))}
		</div>
	</main>
</Layout>