---
import Layout from '../../layouts/Layout.astro';
import { readFileSync } from 'fs';
import { parse } from 'csv-parse/sync';

export async function getStaticPaths() {
    const fileContent = readFileSync('./src/data/weekend.csv', 'utf-8');
    const records = parse(fileContent, { columns: true, skip_empty_lines: true, trim: true });
    return records.map((row) => ({ params: { id: row.id }, props: { info: row } }));
}

const { info } = Astro.props;
---

<Layout 
    title={`Buget Weekend: ${info.destinatie}`}
    description={`Calculator personalizat pentru ${info.destinatie}. AjusteazƒÉ costurile »ôi aflƒÉ bugetul total.`}
>
    <main class="max-w-4xl mx-auto px-4 pb-20">
        <nav class="py-6">
            <a href="/weekend" class="text-sm font-bold text-orange-700 hover:underline">‚Üê √énapoi la listƒÉ</a>
        </nav>

        <header class="mb-10 text-center">
            <h1 class="text-4xl md:text-5xl font-black text-gray-900">{info.destinatie}</h1>
            <p class="text-orange-600 font-bold uppercase tracking-widest text-xs mt-2">{info.regiune}</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-[40px] shadow-2xl border border-orange-100 overflow-hidden">
                    
                    <div class="p-8 bg-gray-900 text-white grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-[10px] font-black uppercase mb-2 opacity-50">Persoane</label>
                            <input type="number" id="persInput" value="2" class="w-full bg-white/10 border border-white/20 rounded-xl p-3 text-white font-bold outline-none">
                        </div>
                        <div>
                            <label class="block text-[10px] font-black uppercase mb-2 opacity-50">Nop»õi</label>
                            <input type="number" id="noptiInput" value="2" class="w-full bg-white/10 border border-white/20 rounded-xl p-3 text-white font-bold outline-none">
                        </div>
                        <div>
                            <label class="block text-[10px] font-black uppercase mb-2 opacity-50">Distan»õƒÉ KM</label>
                            <input type="number" id="kmInput" value={info.distanta_ref * 2} class="w-full bg-white/10 border border-white/20 rounded-xl p-3 text-white font-bold outline-none">
                        </div>
                    </div>

                    <div class="p-8 md:p-12 space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-orange-600 uppercase">Cazare/noapte</label>
                                <input type="number" id="costCazareInput" value={info.pret_cazare} class="w-full border-2 border-gray-100 rounded-2xl p-4 font-black text-xl outline-none focus:border-orange-500">
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-orange-600 uppercase">M√¢ncare/zi/pers</label>
                                <input type="number" id="costMancareInput" value={info.pret_masa} class="w-full border-2 border-gray-100 rounded-2xl p-4 font-black text-xl outline-none focus:border-orange-500">
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-orange-600 uppercase">Distrac»õie/zi/pers</label>
                                <input type="number" id="costDistractieInput" value="100" class="w-full border-2 border-gray-100 rounded-2xl p-4 font-black text-xl outline-none focus:border-orange-500">
                            </div>
                        </div>

                        <div class="mt-12 pt-10 border-t-4 border-dashed border-gray-50 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div>
                                <p class="text-[10px] font-black uppercase text-gray-400">Total Estimat</p>
                                <p class="text-6xl font-black text-orange-600" id="totalDisplay">0 Lei</p>
                            </div>
                            <div class="text-right text-xs text-gray-500 space-y-1">
                                <p>üî• BenzinƒÉ: <span id="benzinaSum" class="font-bold text-gray-800">0 Lei</span></p>
                                <p>üè® Cazare: <span id="cazareSum" class="font-bold text-gray-800">0 Lei</span></p>
                                <p>üç¥ MasƒÉ/Play: <span id="masaSum" class="font-bold text-gray-800">0 Lei</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="bg-gray-900 text-white p-8 rounded-[40px]">
                    <h3 class="font-bold mb-4">Atrac»õii</h3>
                    <p class="text-sm text-gray-400 italic mb-4">"{info.atractii}"</p>
                    <div class="text-xs text-orange-300">üí° {info.tips}</div>
                </div>
                <div class="bg-orange-50 p-8 rounded-[40px] border border-orange-100">
                    <p class="text-sm text-orange-800 leading-relaxed">{info.descriere}</p>
                </div>
            </div>
        </div>
    </main>

    <script is:inline>
        const inputs = {
            pers: document.getElementById('persInput'),
            nopti: document.getElementById('noptiInput'),
            km: document.getElementById('kmInput'),
            cazare: document.getElementById('costCazareInput'),
            mancare: document.getElementById('costMancareInput'),
            distractie: document.getElementById('costDistractieInput')
        };

        const displays = {
            cazare: document.getElementById('cazareSum'),
            masa: document.getElementById('masaSum'),
            benzina: document.getElementById('benzinaSum'),
            total: document.getElementById('totalDisplay')
        };

        function calculate() {
            const p = parseInt(inputs.pers.value) || 0;
            const n = parseInt(inputs.nopti.value) || 0;
            const k = parseInt(inputs.km.value) || 0;
            const prC = parseFloat(inputs.cazare.value) || 0;
            const prM = parseFloat(inputs.mancare.value) || 0;
            const prD = parseFloat(inputs.distractie.value) || 0;

            const totalCazare = n * prC;
            const totalMasa = (n + 1) * p * (prM + prD);
            const totalBenzina = (k / 100) * 8 * 7.5;
            const totalGeneral = totalCazare + totalMasa + totalBenzina;

            displays.cazare.innerText = Math.round(totalCazare).toLocaleString() + " Lei";
            displays.masa.innerText = Math.round(totalMasa).toLocaleString() + " Lei";
            displays.benzina.innerText = Math.round(totalBenzina).toLocaleString() + " Lei";
            displays.total.innerText = Math.round(totalGeneral).toLocaleString() + " Lei";
        }

        Object.values(inputs).forEach(input => {
            input.addEventListener('input', calculate);
        });

        calculate();
    </script>
</Layout>